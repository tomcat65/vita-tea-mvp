# Story 1.6: Product Catalog Data Management System (Admin Portal)

## Status

Draft

## Story

**As a** business owner,
**I want** a separate secure admin portal for comprehensive product data management,
**so that** authorized administrators can safely upload and enrich product information without affecting the customer-facing website.

## Project Separation Notice

This story describes functionality for a **separate project**: `admin-vita-tea`
- **Repository**: Separate from customer-facing site
- **Domain**: admin.vita-tea.com
- **Access**: Restricted to authorized administrators only
- **Database**: Shared Firestore with customer site (different permissions)

## Acceptance Criteria

1. Product upload interface supporting both individual and batch CSV/JSON uploads
2. Research workflow tool for gathering competitive pricing from Amazon and other sources
3. Product enrichment form capturing origin, cultural heritage, brewing procedures, and ceremonies
4. Media management system for uploading and organizing product images and videos
5. Automated pricing suggestions based on competitor research and markup rules
6. Data validation ensuring all required fields meet quality standards before publishing
7. Admin dashboard showing product upload status, missing information, and research tasks
8. Automated product enrichment using Claude API for cultural research and brewing traditions
9. Focus mode to process only selected products for MVP launch

## Tasks / Subtasks

- [ ] Create admin product management interface (AC: 1, 7)
  - [ ] Build product upload form with all schema fields
  - [ ] Implement single product creation/edit functionality
  - [ ] Add draft vs. published status management
  - [ ] Create product preview before publishing
- [ ] Implement batch upload functionality (AC: 1)
  - [ ] Create CSV template matching product schema
  - [ ] Build CSV parser and validator
  - [ ] Implement JSON batch upload option
  - [ ] Add batch upload progress tracking
  - [ ] Handle partial upload failures gracefully
- [ ] Build PDF catalog extraction system (AC: 1, 8)
  - [ ] Create PDF upload interface for QTradeTeas catalogs
  - [ ] Integrate Claude API (Sonnet) for PDF text extraction
  - [ ] Parse extracted data into product format
  - [ ] Preserve QTrade SKUs as primary product IDs
  - [ ] Extract certifications (organic, fair trade, kosher)
  - [ ] Handle multi-page catalog processing
- [ ] Build competitive pricing research tool (AC: 2, 5)
  - [ ] Create price research form with competitor fields
  - [ ] Add manual price entry for Amazon, specialty tea sites
  - [ ] Calculate suggested retail price based on research
  - [ ] Store competitor pricing history
  - [ ] Generate pricing analytics dashboard
- [ ] Develop product enrichment interface (AC: 3)
  - [ ] Create comprehensive product details form
  - [ ] Add fields for origin story and cultural heritage
  - [ ] Include brewing ceremony documentation
  - [ ] Add health benefits research section
  - [ ] Implement rich text editor for descriptions
- [ ] Create media management system (AC: 4)
  - [ ] Build image upload with 3-image minimum validation
  - [ ] Implement image optimization and resizing
  - [ ] Add video URL support (YouTube/Vimeo)
  - [ ] Create media gallery organization
  - [ ] Generate alt text templates for SEO
- [ ] Implement data validation system (AC: 6)
  - [ ] Define required fields based on schema
  - [ ] Create validation rules for each field type
  - [ ] Build quality score calculator
  - [ ] Show missing information warnings
  - [ ] Prevent publishing incomplete products
- [ ] Build research task management (AC: 7)
  - [ ] Create research task queue for products
  - [ ] Track research completion status
  - [ ] Generate research checklists per product
  - [ ] Add research notes and citations
  - [ ] Create research progress dashboard
- [ ] Implement Claude API integration (AC: 8, 9)
  - [ ] Set up Claude API client with Sonnet model
  - [ ] Create product enrichment prompts for cultural research
  - [ ] Build automated research workflow for selected products
  - [ ] Generate brewing ceremony descriptions
  - [ ] Extract health benefits and traditions
  - [ ] Store API responses with citations
- [ ] Create MVP product selection tool (AC: 9)
  - [ ] Build interface to select products for launch
  - [ ] Filter products by wellness categories (digestive, stress, immunity)
  - [ ] Mark selected products for enrichment priority
  - [ ] Track enrichment progress for MVP products
  - [ ] Generate launch readiness report
- [ ] Add Firestore integration
  - [ ] Implement product document creation
  - [ ] Add batch write operations
  - [ ] Create audit trail for changes
  - [ ] Set up automated backups
  - [ ] Handle offline data sync
- [ ] Create manual test checklist
  - [ ] Test single product upload flow
  - [ ] Verify batch upload with edge cases
  - [ ] Test image upload and optimization
  - [ ] Verify pricing calculations
  - [ ] Test validation rules
  - [ ] Check admin dashboard functionality

## Dev Notes

### Enhanced Product Schema
Based on our business needs, extend the existing schema:

[Source: architecture/data-models.md#product-model]
```typescript
interface Product {
  // Existing fields
  id: string; // Will use QTrade SKU (e.g., 'H10075', 'C10041')
  qtradeSkU: string; // Same as id for reference
  name: string;
  description: string;
  price: number;
  category: string;
  subcategory: string;
  isActive: boolean;
  featured: boolean;
  inventory: number;
  
  // Enhanced fields for Story 1.6
  origin: {
    country: string;
    region: string;
    altitude?: string;
    harvestSeason?: string;
    processingMethod?: string;
  };
  
  culturalHeritage: {
    history: string;
    ceremonies: string[];
    traditions: string;
    folklore?: string;
  };
  
  brewing: {
    temperature: string;
    time: string;
    ratio: string;
    instructions: string;
    tips?: string[];
    ceremonialInstructions?: string;
  };
  
  media: {
    images: ProductImage[]; // Min 3 required
    videos?: VideoLink[];
    documents?: DocumentLink[];
  };
  
  pricing: {
    cost: number;
    suggestedRetail: number;
    competitorPrices: CompetitorPrice[];
    markup: number;
    lastResearchDate: Timestamp;
  };
  
  research: {
    status: 'pending' | 'in-progress' | 'complete';
    completedFields: string[];
    missingFields: string[];
    qualityScore: number; // 0-100
    notes: ResearchNote[];
  };
  
  seo: {
    metaTitle: string;
    metaDescription: string;
    keywords: string[];
    slug: string;
  };
  
  certifications: string[]; // ['organic', 'fair-trade', 'kosher', etc.]
  allergens?: string[];
  
  createdAt: Timestamp;
  updatedAt: Timestamp;
  createdBy: string; // Admin user ID
  lastModifiedBy: string;
}

interface ProductImage {
  url: string;
  alt: string;
  isPrimary: boolean;
  order: number;
}

interface CompetitorPrice {
  source: string; // 'amazon', 'teavana', etc.
  price: number;
  url?: string;
  lastChecked: Timestamp;
}
```

### Admin Routes Structure
[Source: architecture/frontend-architecture.md#routing]
```
/admin/products/             - Product list dashboard
/admin/products/new          - Create new product
/admin/products/edit/:id     - Edit existing product
/admin/products/import       - Batch import interface
/admin/products/research     - Research task dashboard
```

### Batch Upload CSV Template
```csv
qtrade_sku,name,category,subcategory,price,origin_country,origin_region,brew_temp,brew_time,description
"A10040","Organic Earl Grey","Black Tea","Classic",24.99,"Sri Lanka","Nuwara Eliya","200°F","3-5 min","Premium organic Earl Grey..."
"H10075","Organic Peppermint C/S","Herbal Tea","Digestive",18.99,"USA","Pacific Northwest","212°F","5-7 min","Soothing peppermint..."
```

### Firebase Security Rules Update
[Source: architecture/database-schema.md#security-rules]
```javascript
// Products can only be written by admin users
match /products/{productId} {
  allow read: if true;
  allow write: if request.auth != null && 
    get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
}
```

### Image Storage Structure
[Source: architecture/unified-project-structure.md]
```
/public/images/products/
├── {qtradeSkU}/          # e.g., H10075, C10041
│   ├── primary.jpg     (800x800)
│   ├── image-2.jpg     (800x800)
│   ├── image-3.jpg     (800x800)
│   └── thumbnails/
│       ├── primary.jpg (200x200)
│       ├── image-2.jpg (200x200)
│       └── image-3.jpg (200x200)
```

### Research Workflow States
```
1. Product Created → Research Status: 'pending'
2. Research Started → Research Status: 'in-progress'
3. All Required Fields Completed → Research Status: 'complete'
4. Quality Score >= 80 → Product can be published (isActive: true)
```

### Integration with Existing Systems
- Uses existing Firebase authentication for admin access
- Leverages current Alpine.js patterns for reactive UI
- Extends product schema while maintaining backward compatibility
- Reuses image upload patterns from other parts of the system

### Competitive Research Sources
Suggested research sources to track:
- Amazon.com (primary competitor pricing)
- Teavana.com (Starbucks tea brand)
- DavidsTea.com (specialty tea retailer)
- Adagio.com (online tea specialist)
- Local specialty tea shops
- Whole Foods Market (organic pricing)

### Claude API Integration
```javascript
// Cloud Function for product enrichment
async function enrichProductWithClaude(productData, enrichmentType) {
  const CLAUDE_API_KEY = process.env.CLAUDE_API_KEY;
  
  const prompts = {
    cultural: `Research the cultural heritage and traditions for ${productData.name} tea.
                Include: origin history, ceremonial uses, folklore, and cultural significance.
                Focus on authentic, respectful representation.`,
    
    brewing: `Provide traditional and modern brewing methods for ${productData.name}.
              Include: water temperature, steeping time, ceremonial preparations,
              and tips for optimal flavor extraction.`,
    
    health: `Research evidence-based health benefits of ${productData.name}.
             Include: active compounds, traditional medicinal uses, 
             and modern scientific findings. Be factual and avoid health claims.`,
             
    pairings: `Suggest food pairings and occasions for ${productData.name}.
               Consider both traditional pairings and modern wellness contexts.`
  };
  
  const response = await fetch('https://api.anthropic.com/v1/messages', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'x-api-key': CLAUDE_API_KEY,
      'anthropic-version': '2023-06-01'
    },
    body: JSON.stringify({
      model: 'claude-3-sonnet-20240229',
      max_tokens: 1500,
      messages: [{
        role: 'user',
        content: prompts[enrichmentType]
      }]
    })
  });
  
  return response.json();
}
```

### PDF Processing Workflow
```javascript
// Extract product data from QTrade catalog PDF
async function processCatalogPDF(pdfBuffer) {
  // Step 1: Convert PDF to base64 for Claude
  const base64PDF = pdfBuffer.toString('base64');
  
  // Step 2: Send to Claude for extraction
  const extractionPrompt = `
    Extract product information from this QTrade tea catalog.
    For each product, capture:
    - Item Code (SKU)
    - Name
    - Category (Black, Green, White, Oolong, Herbal, etc.)
    - Origin
    - Grade
    - Certifications (Organic, Fair Trade, Kosher, etc.)
    - Case weight
    
    Format as JSON array.
  `;
  
  // Step 3: Parse and use QTrade SKU as product ID
  const products = await parseClaudeResponse(response);
  const mappedProducts = products.map(p => ({
    id: p.itemCode, // Use QTrade SKU as primary ID
    qtradeSkU: p.itemCode,
    name: p.name,
    category: p.category,
    origin: p.origin,
    certifications: p.certifications,
    ...p
  }));
  
  // Step 4: Filter for MVP products
  const mvpProducts = mappedProducts.filter(p => 
    MVP_PRODUCT_SKUS.includes(p.id)
  );
  
  return mvpProducts;
}
```

### MVP Product Selection
Based on our wellness categories, focus on these product types:

```javascript
const MVP_PRODUCT_CRITERIA = {
  digestive: [
    'peppermint', 'ginger', 'chamomile', 'fennel',
    'licorice', 'dandelion'
  ],
  stress_relief: [
    'lavender', 'lemon balm', 'passionflower', 'chamomile',
    'tulsi', 'ashwagandha'
  ],
  immunity: [
    'hibiscus', 'elderberry', 'echinacea', 'ginger',
    'turmeric', 'green tea', 'matcha'
  ]
};
```

### MVP Product SKUs from QTrade Catalog
```javascript
// Direct QTrade SKUs to use for MVP launch
const MVP_PRODUCT_SKUS = [
  // Digestive Wellness
  'H10075', // Organic Peppermint C/S
  'H10074', // Organic Peppermint TBC
  'H10006', // Organic Ginger C/S
  'F10007', // Organic Chamomile Whole
  
  // Stress Relief  
  'H10010', // Organic Lemon Balm TBC
  'H10011', // Organic Lavender Flower Whole
  'H10120', // Organic Tulsi (Holy Basil)
  
  // Immunity Boost
  'F10007', // Organic Hibiscus C/S
  'C10041', // Organic Matcha Powder
  'H10138', // Organic Turmeric C/S
  'C10023', // Organic Gunpowder Green Tea
  
  // Premium Additions
  'A10040', // Organic Earl Grey
  'C10032', // Organic Keemun Black Tea
];

// Product document ID example: /products/H10075
// Image path example: /images/products/H10075/primary.jpg
```

### Previous Story Insights
From Story 1.5:
- Admin routes need AuthGuard protection
- Use Web Components for reusable form elements
- Implement proper error handling and user feedback
- Consider offline capability for admin tasks

### Missing Architecture Guidance
The following items have no specific guidance in architecture docs:
- Bulk upload error recovery strategies
- Image optimization pipeline details
- Research workflow state machine
- Competitive pricing API integrations
- CSV parsing library selection
- Claude API integration patterns
- PDF processing in Firebase Functions

## Testing

### Test Standards
[Source: architecture/testing-strategy.md#frontend-testing]
- **Test Location**: Manual test checklists in `/docs/testing/`
- **Browser Testing**: Chrome, Firefox, Safari (latest versions)
- **File Upload Testing**: Test with various file sizes and formats
- **Performance**: Batch upload of 100 products < 30s
- **Data Validation**: All validation rules must have test cases

### Admin Testing Scenarios
- Upload single product with all fields
- Batch upload 50 products via CSV
- Upload with missing required fields (should fail)
- Add exactly 3 images per product
- Test pricing calculator with various markups
- Verify research task queue updates
- Test offline functionality and sync

## Change Log

| Date       | Version | Description           | Author           |
| ---------- | ------- | --------------------- | ---------------- |
| 2025-08-27 | 1.0     | Initial story creation | Scrum Master Bob |

## Dev Agent Record

_This section will be populated by the development agent during implementation_

### Agent Model Used

_To be filled by Dev Agent_

### Debug Log References

_To be filled by Dev Agent_

### Completion Notes List

_To be filled by Dev Agent_

### File List

_To be filled by Dev Agent_

## QA Results

_This section will be populated by the QA agent after implementation review_